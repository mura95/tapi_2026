<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android" xmlns:tools="http://schemas.android.com/tools" package="jp.co.pichipichi.petdisplay">
  <!-- ネットワーク系 -->
  <uses-permission android:name="android.permission.INTERNET" />
  <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
  <!-- ホームアプリとして機能するための権限 -->
  <uses-permission android:name="android.permission.GET_TASKS" />
  <uses-permission android:name="android.permission.REORDER_TASKS" />
  <!-- システムUIを制御するための権限 -->
  <uses-permission android:name="android.permission.EXPAND_STATUS_BAR" />
  <!-- 他のアプリの情報を取得 -->
  <uses-permission android:name="android.permission.QUERY_ALL_PACKAGES" tools:ignore="QueryAllPackagesPermission" />
  <!-- アラーム関連の権限 -->
  <uses-permission android:name="android.permission.SCHEDULE_EXACT_ALARM" android:maxSdkVersion="32" />
  <uses-permission android:name="android.permission.USE_EXACT_ALARM" tools:targetApi="33" />
  <!-- ★ 端末再起動後のアラーム復旧に必須 -->
  <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
  <!-- ★ WakeLockを使用して画面を確実に点灯させる -->
  <uses-permission android:name="android.permission.WAKE_LOCK" />
  <!-- ★ 通知を表示する権限（Android 13以降） -->
  <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />
  <!-- ★ バッテリー最適化の無視をリクエスト（任意） -->
  <uses-permission android:name="android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS" />
  <!-- ★ フォアグラウンドサービス権限（追加） -->
  <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
  <uses-permission android:name="android.permission.FOREGROUND_SERVICE_SPECIAL_USE" />
  <application android:label="@string/app_name" android:icon="@mipmap/app_icon" android:roundIcon="@mipmap/app_icon_round" android:allowBackup="true" android:usesCleartextTraffic="true" android:supportsRtl="true">
    <!-- Unity のメイン Activity -->
    <activity android:name="com.unity3d.player.appui.AppUIActivity" android:exported="true" android:launchMode="singleTask" android:screenOrientation="portrait" android:configChanges="orientation|keyboardHidden|screenSize|screenLayout|smallestScreenSize|uiMode|density" android:theme="@style/UnityThemeSelector" android:showWhenLocked="true" android:turnScreenOn="true" android:stateNotNeeded="true" android:clearTaskOnLaunch="true" android:excludeFromRecents="false">
      <!-- 通常起動 -->
      <intent-filter>
        <action android:name="android.intent.action.MAIN" />
        <category android:name="android.intent.category.LAUNCHER" />
      </intent-filter>
      <!-- ホームアプリとして認識 -->
      <intent-filter android:priority="1">
        <action android:name="android.intent.action.MAIN" />
        <category android:name="android.intent.category.HOME" />
        <category android:name="android.intent.category.DEFAULT" />
      </intent-filter>
      <!-- システムがホーム画面を要求した時 -->
      <intent-filter>
        <action android:name="android.intent.action.ASSIST" />
        <category android:name="android.intent.category.DEFAULT" />
      </intent-filter>
      <!-- Deep Link: taphouse://auth スキームを受信 -->
      <intent-filter>
        <action android:name="android.intent.action.VIEW" />
        <category android:name="android.intent.category.DEFAULT" />
        <category android:name="android.intent.category.BROWSABLE" />
        <data android:scheme="taphouse" android:host="auth" />
      </intent-filter>
      <meta-data android:name="unityplayer.UnityActivity" android:value="true" />
    </activity>
    <!-- ★ 毎朝の起床アラームを受ける BroadcastReceiver -->
    <receiver android:name="jp.co.pichipichi.petdisplay.WakeAlarmReceiver" android:exported="false" android:directBootAware="true" android:enabled="true">
      <intent-filter>
        <action android:name="jp.co.pichipichi.petdisplay.ACTION_ALARM_WAKE" />
        <category android:name="android.intent.category.DEFAULT" />
      </intent-filter>
    </receiver>
    <!-- ★ 端末再起動・時刻変更時にアラームを復旧する BroadcastReceiver -->
    <receiver android:name="jp.co.pichipichi.petdisplay.AlarmRestoreReceiver" android:exported="false" android:directBootAware="true" android:enabled="true">
      <intent-filter>
        <action android:name="android.intent.action.BOOT_COMPLETED" />
        <action android:name="android.intent.action.LOCKED_BOOT_COMPLETED" />
        <action android:name="android.intent.action.TIME_SET" />
      </intent-filter>
    </receiver>
    <!-- ホームボタンが押された時の処理を受信 -->
    <receiver android:name=".HomeKeyReceiver" android:exported="false">
      <intent-filter android:priority="1000">
        <action android:name="android.intent.action.CLOSE_SYSTEM_DIALOGS" />
      </intent-filter>
    </receiver>
  </application>
  <uses-permission android:name="android.permission.VIBRATE" />
</manifest>