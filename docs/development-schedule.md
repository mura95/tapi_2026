# 開発スケジュール

## 概要

たっぷハウス・たっぷポケットの開発スケジュール。各フェーズ約1週間で進行。

```
┌─────────────────────────────────────────────────────────────────────┐
│                        開発ロードマップ                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Week 1          Week 2          Week 3          Week 4             │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐         │
│  │ Phase 1 │───→│ Phase 2 │───→│ Phase 3 │───→│ Phase 4 │         │
│  │ログイン │    │ポケット │    │メタバース│    │  課金   │         │
│  └─────────┘    └─────────┘    └─────────┘    └─────────┘         │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## Phase 1: ログイン機能（Week 1）

### 目標
たっぷハウス・たっぷポケットのログイン基盤を構築（方式が異なる）

### アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                    ログイン方式の違い                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  たっぷハウス（タブレット）    たっぷポケット（スマホ）       │
│  ┌─────────────────────┐    ┌─────────────────────┐        │
│  │  Unity内ログイン     │    │  OSブラウザログイン │        │
│  │  （現状維持）        │    │  （Firebase Hosting）│       │
│  │                     │    │                     │        │
│  │  - Kioskモード対応   │    │  - セキュリティ向上  │        │
│  │  - ブラウザ不可     │    │  - Google認証対応   │        │
│  └─────────────────────┘    └─────────────────────┘        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### タスク一覧

| # | タスク | 対象 | 詳細 | 優先度 |
|---|--------|------|------|--------|
| 1-1 | ModeSelect.unityシーン | Unity | 起動・モード選択画面 | 必須 |
| 1-2 | ModeSelectManager.cs | Unity | Firebase初期化・認証確認・モード選択UI | 必須 |
| 1-3 | AppModeManager.cs | Unity | PlayerPrefsでモード保存・読込 | 必須 |
| 1-4 | たっぷハウス ログイン | Unity | 現状のlogin.unity維持・確認 | 必須 |
| 1-5 | Webログインページ作成 | Web | Firebase Hosting + HTML/JS | 必須 |
| 1-6 | メール/パスワード認証（Web） | Web | Firebase Auth JS SDK | 必須 |
| 1-7 | Googleサインイン（Web） | Web | Firebase Auth Google Provider | 必須 |
| 1-8 | カスタムトークン生成 | Cloud | Firebase Functions | 必須 |
| 1-9 | Deep Link設定 | Unity | Android/iOS設定 | 必須 |
| 1-10 | Deep Link受信処理 | Unity | PocketAuthManager.cs | 必須 |

### 技術要件

```
たっぷハウス:
└── Firebase Auth（Unity SDK）
    └── Email/Password Provider

たっぷポケット:
├── Firebase Hosting（Webログインページ）
├── Firebase Auth（Web JS SDK）
│   ├── Email/Password Provider
│   └── Google Provider
├── Firebase Functions（カスタムトークン生成）
└── Deep Link（taphouse://auth?token=xxx）
```

### 画面フロー

```
┌─────────────────────────────────────────────────────────────┐
│                     起動フロー全体                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  アプリ起動 → ModeSelect.unity                             │
│       ↓                                                    │
│  Firebase初期化 → 認証状態確認                             │
│       │                                                    │
│  ┌────┴────┐                                               │
│  │         │                                               │
│  ログイン済み  未ログイン                                    │
│  │         │                                               │
│  保存モードで  モード選択UIを表示                            │
│  即遷移        │                                            │
│  (main/       ┌┴─────────┐                                 │
│  PocketMain)  │          │                                 │
│          「ハウス」    「ポケット」                           │
│               │           │                                │
│          login.unity  OSブラウザ                            │
│               │     https://taphouse.web.app/login         │
│               │           │                                │
│               ↓     Deep Link で戻る                        │
│          main.unity   taphouse://auth?token=xxx            │
│                           │                                │
│                    PocketMain.unity                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 成果物

**Unity側（モード選択・起動）:**
- [ ] ModeSelect.unity（起動・モード選択画面）
- [ ] ModeSelectManager.cs（起動処理・モード選択UI）
- [ ] AppModeManager.cs（モード保存・読込）

**Unity側（認証）:**
- [ ] PocketAuthManager.cs（ブラウザ認証管理）
- [ ] DeepLinkHandler.cs（Deep Link受信処理）
- [ ] Android/iOS Deep Link設定

**Web側:**
- [ ] Firebase Hosting設定
- [ ] index.html（ログインページ）
- [ ] auth.js（認証ロジック）
- [ ] style.css（スタイル）

**Cloud側:**
- [ ] Firebase Functions（createCustomToken）

### 参照ドキュメント

- [docs/login/README.md](./login/README.md)
- [docs/login/mode-selection.md](./login/mode-selection.md)
- [docs/login/pocket-browser-login.md](./login/pocket-browser-login.md)

---

## Phase 2: たっぷポケット構築（Week 2）

### 目標
たっぷポケットのコア機能を実装

### タスク一覧

| # | タスク | 詳細 | 優先度 |
|---|--------|------|--------|
| 2-1 | ポケットメイン画面 | PocketMain.unity | 必須 |
| 2-2 | コール機能 | 犬を呼び出してフル機能へ | 必須 |
| 2-3 | 着せ替え画面 | 犬の服・帽子変更 | 必須 |
| 2-4 | 歩数計連携 | Google Fit / HealthKit | 必須 |
| 2-5 | 犬と遊ぼう | ミニゲーム選択画面 | 必須 |
| 2-6 | スマホ向けUI最適化 | 大きなボタン、高コントラスト | 必須 |

※ AppMode管理はPhase 1で実装済み（AppModeManager.cs）

### 画面構成

```
┌─────────────────────────────────────────────────────────────┐
│                  ポケットメイン画面                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│    ┌─────────────┐    ┌─────────────┐                      │
│    │   コール     │    │   着せ替え   │                      │
│    │     🐕      │    │     👕      │                      │
│    └─────────────┘    └─────────────┘                      │
│                                                             │
│    ┌─────────────┐    ┌─────────────┐                      │
│    │   歩数計    │    │  犬と遊ぼう  │                      │
│    │     👟      │    │     🎮      │                      │
│    └─────────────┘    └─────────────┘                      │
│                                                             │
│                    ┌─────────────┐                          │
│                    │    設定     │                          │
│                    │     ⚙️      │                          │
│                    └─────────────┘                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 成果物

- [ ] PocketMain.unity（ポケットホーム画面）
- [ ] PocketUIController.cs（ポケットUI）
- [ ] CallDogManager.cs（コール機能）
- [ ] StepCounterManager.cs（歩数計）
- [ ] DressUpManager.cs（着せ替え）

### 参照ドキュメント

- [pocket-overview.md](./pocket/pocket-overview.md)

---

## Phase 3: メタバース内散歩（Week 3）

### 目標
ポケット内蔵のメタバース散歩機能を実装

### タスク一覧

| # | タスク | 詳細 | 優先度 |
|---|--------|------|--------|
| 3-1 | メタバースシーン | Metaverse.unity | 必須 |
| 3-2 | 加速度センサー歩行 | スマホを振って移動 | 必須 |
| 3-3 | 犬の追従 | プレイヤーについて歩く | 必須 |
| 3-4 | Photon Fusion 2導入 | マルチプレイ基盤 | 必須 |
| 3-5 | 他ユーザー同期 | 位置・状態同期 | 必須 |
| 3-6 | Photon Voice 2導入 | 音声通話基盤 | 追加 |
| 3-7 | 近接音声 | 近づくと声が聞こえる | 追加 |
| 3-8 | 音量ブースト | 高齢者向け音量増幅 | 追加 |

### 技術スタック

```
Photon Fusion 2
├── ネットワーク同期
├── ルーム管理
└── プレイヤー生成

Photon Voice 2
├── 音声通話
├── 近接音声
└── ミュート機能
```

### メタバース画面

```
┌─────────────────────────────────────┐
│ [やめる]      散歩中     [🎤 ミュート] │
├─────────────────────────────────────┤
│                                     │
│   ┌─────────────────────────────┐   │
│   │      🌳      🌳             │   │
│   │         👤                  │   │
│   │         🐕                  │   │
│   │   🌳              🏠        │   │
│   │              👥             │   │
│   │              🐶             │   │
│   └─────────────────────────────┘   │
│                                     │
│   📱 スマホを振って歩こう！          │
│                                     │
│   歩数: 234 歩   距離: 120m         │
└─────────────────────────────────────┘
```

### 成果物

- [ ] Metaverse.unity（メタバースシーン）
- [ ] AccelerometerWalkController.cs（加速度歩行）
- [ ] MetaverseDogFollower.cs（犬の追従）
- [ ] PhotonNetworkManager.cs（Photon管理）
- [ ] VoiceChatManager.cs（音声通話）
- [ ] ElderlyVoiceEnhancer.cs（音量ブースト）

### 参照ドキュメント

- [pocket-metaverse-overview.md](./pocket/metaverse/pocket-metaverse-overview.md)
- [pocket-voice-call.md](./pocket/metaverse/pocket-voice-call.md)

---

## Phase 4: 課金プラットフォーム（Week 4）

### 目標
アプリ内課金システムを構築

### タスク一覧

| # | タスク | 詳細 | 優先度 |
|---|--------|------|--------|
| 4-1 | Unity IAP導入 | In-App Purchase 設定 | 必須 |
| 4-2 | 商品定義 | 課金アイテムの設定 | 必須 |
| 4-3 | ストア画面 | 購入UI | 必須 |
| 4-4 | 購入処理 | 決済フロー実装 | 必須 |
| 4-5 | レシート検証 | サーバーサイド検証 | 必須 |
| 4-6 | 復元機能 | 購入済みアイテム復元 | 必須 |
| 4-7 | Firebase連携 | 購入履歴の保存 | 追加 |

### 課金アイテム案

| カテゴリ | アイテム | 価格帯 | 種類 |
|---------|---------|--------|------|
| 着せ替え | 服・帽子セット | ¥120〜¥480 | 消費型 |
| プレミアム | 広告削除 | ¥480 | 非消費型 |
| 通貨 | ゲーム内コイン | ¥120〜¥1,200 | 消費型 |
| サブスク | プレミアム会員 | ¥480/月 | 定期購読 |

### アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                    課金システム構成                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    │
│  │   ストアUI   │───→│  IAPManager │───→│ Google Play │    │
│  │             │    │             │    │ / App Store │    │
│  └─────────────┘    └──────┬──────┘    └─────────────┘    │
│                            │                               │
│                            ▼                               │
│                    ┌─────────────┐                         │
│                    │  Firebase   │                         │
│                    │  購入履歴   │                         │
│                    └─────────────┘                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 成果物

- [ ] IAPManager.cs（課金管理）
- [ ] StoreUIController.cs（ストア画面）
- [ ] ProductCatalog.asset（商品カタログ）
- [ ] ReceiptValidator.cs（レシート検証）
- [ ] PurchaseHistoryManager.cs（購入履歴）

---

## 全体スケジュール

```
Week 1 (Phase 1: ログイン)
├── Day 1-2: Startup/ModeSelect.unity作成、モード選択UI
├── Day 3-4: Firebase Hosting設定、Webログインページ作成
├── Day 5-6: Deep Link設定、カスタムトークン連携
└── Day 7: テスト、バグ修正

Week 2 (Phase 2: ポケット)
├── Day 1-2: AppMode、ポケットメイン画面
├── Day 3-4: コール機能、着せ替え
├── Day 5-6: 歩数計、犬と遊ぼう
└── Day 7: UI調整、テスト

Week 3 (Phase 3: メタバース)
├── Day 1-2: メタバースシーン、加速度歩行
├── Day 3-4: Photon Fusion導入、マルチプレイ
├── Day 5-6: Photon Voice導入、音声通話
└── Day 7: 統合テスト

Week 4 (Phase 4: 課金)
├── Day 1-2: Unity IAP設定、商品定義
├── Day 3-4: ストア画面、購入処理
├── Day 5-6: レシート検証、復元機能
└── Day 7: ストア申請準備
```

---

## 依存関係

```
Phase 1: ログイン ←────────────────────────────────┐
    │                                              │
    ▼                                              │
Phase 2: ポケット ← Phase 1 必須                   │
    │                                              │
    ▼                                              │
Phase 3: メタバース ← Phase 2 推奨                 │
    │                                              │
    ▼                                              │
Phase 4: 課金 ← Phase 1 必須（ユーザー識別のため） ─┘
```

---

## リスクと対策

| リスク | 影響 | 対策 |
|--------|------|------|
| Firebase設定ミス | ログイン不可 | 事前に開発環境で検証 |
| Photon接続問題 | メタバース利用不可 | フォールバックUI用意 |
| ストア審査遅延 | リリース遅延 | 早めの申請、ガイドライン確認 |
| 課金バグ | 売上影響 | サーバーサイド検証必須 |

---

## 関連ドキュメント

| ドキュメント | 内容 |
|-------------|------|
| [login/mode-selection.md](./login/mode-selection.md) | モード選択画面 |
| [login/README.md](./login/README.md) | ログインシステム概要 |
| [pocket-overview.md](./pocket/pocket-overview.md) | ポケット全体仕様 |
| [pocket-metaverse-overview.md](./pocket/metaverse/pocket-metaverse-overview.md) | メタバース仕様 |
| [firebase/](./firebase/) | Firebase連携 |
