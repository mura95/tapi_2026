# ãƒã‚±ãƒƒãƒˆãƒ¡ã‚¤ãƒ³ç”»é¢ æ§‹ç¯‰æ‰‹é †

## æ¦‚è¦

ãŸã£ã·ãƒã‚±ãƒƒãƒˆã®ãƒ¡ã‚¤ãƒ³ç”»é¢ï¼ˆPocketMain.unityï¼‰ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®æ‰‹é †æ›¸ã€‚

---

## ç”»é¢ä»•æ§˜

### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆ2Ã—2ã‚°ãƒªãƒƒãƒ‰ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãŸã£ã·ãƒã‚±ãƒƒãƒˆ             [âš™è¨­å®š] â”‚ â† è¨­å®šã¯Webãƒ–ãƒ©ã‚¦ã‚¶ã§mypageã‚’é–‹ã
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚             â”‚ â”‚             â”‚   â”‚
â”‚   â”‚  ğŸ• ã‚³ãƒ¼ãƒ«   â”‚ â”‚  ğŸ‘• ç€æ›¿ãˆ   â”‚   â”‚
â”‚   â”‚             â”‚ â”‚             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚             â”‚ â”‚             â”‚   â”‚
â”‚   â”‚  ğŸ‘Ÿ æ­©æ•°è¨ˆ   â”‚ â”‚ ğŸ® çŠ¬ã¨éŠã¶  â”‚   â”‚
â”‚   â”‚             â”‚ â”‚             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒœã‚¿ãƒ³æ©Ÿèƒ½

| ãƒœã‚¿ãƒ³ | å‹•ä½œ |
|--------|------|
| ã‚³ãƒ¼ãƒ« | main.unityã«é·ç§»ï¼ˆçŠ¬ã‚’å‘¼ã‚“ã§ãƒ•ãƒ«æ©Ÿèƒ½ã‚’ä½¿ã†ï¼‰ |
| ç€æ›¿ãˆ | DressUp.unityã«é·ç§» |
| æ­©æ•°è¨ˆ | Pedometer.unityã«é·ç§» |
| çŠ¬ã¨éŠã¶ | MiniGames.unityã«é·ç§» |
| è¨­å®š | OSãƒ–ãƒ©ã‚¦ã‚¶ã§TapHouseWebã®mypageã‚’é–‹ã |

### è‡ªå‹•å¸°é‚„æ©Ÿèƒ½

**é‡è¦:** ãƒã‚±ãƒƒãƒˆãƒ¡ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹ã¨ã€çŠ¬ã¯è‡ªå‹•çš„ã«ãƒ¡ã‚¤ãƒ³æ©Ÿã«å¸°é‚„ã™ã‚‹ã€‚

```
main.unityï¼ˆçŠ¬ã¨éŠã‚“ã§ã„ã‚‹ï¼‰
        â†“
  æˆ»ã‚‹ãƒœã‚¿ãƒ³ç­‰
        â†“
PocketMain.unity ã«é·ç§»
        â†“
OnEnable() ã§ ReturnDogToMain() å‘¼ã³å‡ºã—
        â†“
çŠ¬ãŒãƒ¡ã‚¤ãƒ³æ©Ÿã«è‡ªå‹•å¸°é‚„
```

---

## å‰ææ¡ä»¶

- Unity 6 (6000.2.8f1) ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
- æ—¢å­˜ã®ãŸã£ã·ãƒã‚¦ã‚¹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå‹•ä½œã™ã‚‹çŠ¶æ…‹
- Firebaseè¨­å®šãŒå®Œäº†ã—ã¦ã„ã‚‹

---

## æ§‹ç¯‰æ‰‹é †

### Phase 1: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ

#### Step 1.1: AppConfig.cs ã®ä½œæˆ

`Assets/Scripts/Pocket/AppConfig.cs`:

```csharp
using UnityEngine;
using TapHouse.MultiDevice;

namespace TapHouse.Pocket
{
    public enum AppMode
    {
        TapHouse,   // ãŸã£ã·ãƒã‚¦ã‚¹ï¼ˆãƒ¡ã‚¤ãƒ³ç”»é¢ã‹ã‚‰é–‹å§‹ï¼‰
        TapPocket   // ãŸã£ã·ãƒã‚±ãƒƒãƒˆï¼ˆãƒã‚±ãƒƒãƒˆç”»é¢ã‹ã‚‰é–‹å§‹ï¼‰
    }

    public class AppConfig : MonoBehaviour
    {
        public static AppConfig Instance { get; private set; }

        [Header("ã‚¢ãƒ—ãƒªãƒ¢ãƒ¼ãƒ‰")]
        [SerializeField] private AppMode appMode = AppMode.TapPocket;

        public AppMode Mode => appMode;
        public bool IsPocket => appMode == AppMode.TapPocket;

        private void Awake()
        {
            if (Instance != null && Instance != this)
            {
                Destroy(gameObject);
                return;
            }
            Instance = this;
            DontDestroyOnLoad(gameObject);
        }

        private void Start()
        {
            if (IsPocket && DogLocationSync.Instance != null)
            {
                DogLocationSync.Instance.SetDeviceRole(DeviceRole.Sub);
            }
        }
    }
}
```

#### Step 1.2: PocketMainUI.cs ã®ä½œæˆ

`Assets/Scripts/UI/ModeSelect/PocketMainUI.cs`:

```csharp
using UnityEngine;
using UnityEngine.UI;
using UnityEngine.SceneManagement;
using TMPro;
using TapHouse.MultiDevice;

namespace TapHouse.Pocket.UI
{
    /// <summary>
    /// ãƒã‚±ãƒƒãƒˆãƒ¡ã‚¤ãƒ³ç”»é¢ã®UIåˆ¶å¾¡
    /// </summary>
    public class PocketMainUI : MonoBehaviour
    {
        [Header("2Ã—2ã‚°ãƒªãƒƒãƒ‰ãƒœã‚¿ãƒ³")]
        [SerializeField] private Button callButton;
        [SerializeField] private Button dressUpButton;
        [SerializeField] private Button pedometerButton;
        [SerializeField] private Button miniGameButton;

        [Header("ãƒ˜ãƒƒãƒ€ãƒ¼")]
        [SerializeField] private Button settingsButton;

        [Header("ã‚³ãƒ¼ãƒ«ãƒœã‚¿ãƒ³è¡¨ç¤º")]
        [SerializeField] private TMP_Text callButtonText;
        [SerializeField] private GameObject loadingIndicator;

        [Header("Mypage URL")]
        [SerializeField] private string mypageUrl = "https://your-taphouse-web-url.com/mypage";

        private void OnEnable()
        {
            // ãƒã‚±ãƒƒãƒˆãƒ¡ã‚¤ãƒ³ç”»é¢ã«æˆ»ã£ãŸã‚‰çŠ¬ã‚’è‡ªå‹•å¸°é‚„
            ReturnDogToMainIfNeeded();
        }

        private void Start()
        {
            SetupButtons();
            SetupDogLocationSync();
        }

        private void OnDestroy()
        {
            if (DogLocationSync.Instance != null)
            {
                DogLocationSync.Instance.OnTransferStarted -= OnTransferStarted;
            }
        }

        #region Setup

        private void SetupButtons()
        {
            // ã‚³ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ â†’ main.unityã«é·ç§»
            callButton?.onClick.AddListener(OnCallButtonClicked);

            // ç€ã›æ›¿ãˆãƒœã‚¿ãƒ³
            dressUpButton?.onClick.AddListener(() => {
                SceneManager.LoadScene("DressUp");
            });

            // æ­©æ•°è¨ˆãƒœã‚¿ãƒ³
            pedometerButton?.onClick.AddListener(() => {
                SceneManager.LoadScene("Pedometer");
            });

            // ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³
            miniGameButton?.onClick.AddListener(() => {
                SceneManager.LoadScene("MiniGames");
            });

            // è¨­å®šãƒœã‚¿ãƒ³ â†’ Webãƒ–ãƒ©ã‚¦ã‚¶ã§mypageã‚’é–‹ã
            settingsButton?.onClick.AddListener(OnSettingsButtonClicked);
        }

        private void SetupDogLocationSync()
        {
            if (DogLocationSync.Instance == null)
            {
                Debug.LogWarning("DogLocationSync.Instance is null");
                return;
            }

            // ãƒã‚±ãƒƒãƒˆã¯å¸¸ã«ã‚µãƒ–æ©Ÿ
            DogLocationSync.Instance.SetDeviceRole(DeviceRole.Sub);

            // ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­
            DogLocationSync.Instance.OnTransferStarted += OnTransferStarted;
        }

        #endregion

        #region Button Handlers

        private async void OnCallButtonClicked()
        {
            if (DogLocationSync.Instance == null)
            {
                Debug.LogError("DogLocationSync.Instance is null");
                // Firebaseãªã—ã§ã‚‚é·ç§»ã¯è¨±å¯
                SceneManager.LoadScene("main");
                return;
            }

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            SetLoading(true);

            // çŠ¬ã‚’å‘¼ã¶
            await DogLocationSync.Instance.RequestCallDog();

            // main.unityã«é·ç§»
            SceneManager.LoadScene("main");
        }

        private void OnSettingsButtonClicked()
        {
            // OSã®ãƒ–ãƒ©ã‚¦ã‚¶ã§mypageã‚’é–‹ã
            Application.OpenURL(mypageUrl);
        }

        #endregion

        #region Dog Auto Return

        /// <summary>
        /// ãƒã‚±ãƒƒãƒˆãƒ¡ã‚¤ãƒ³ç”»é¢ã«æˆ»ã£ãŸã‚‰çŠ¬ã‚’ãƒ¡ã‚¤ãƒ³æ©Ÿã«å¸°é‚„
        /// </summary>
        private async void ReturnDogToMainIfNeeded()
        {
            if (DogLocationSync.Instance == null) return;

            if (DogLocationSync.Instance.HasDog)
            {
                Debug.Log("Returning dog to main device (auto return on PocketMain)");
                await DogLocationSync.Instance.ReturnDogToMain();
            }
        }

        #endregion

        #region Events

        private void OnTransferStarted(bool isEntering)
        {
            SetLoading(true);
        }

        #endregion

        #region UI Updates

        private void SetLoading(bool isLoading)
        {
            if (callButton != null)
            {
                callButton.interactable = !isLoading;
            }

            if (callButtonText != null)
            {
                callButtonText.text = isLoading ? "èª­ã¿è¾¼ã¿ä¸­..." : "ã‚³ãƒ¼ãƒ«";
            }

            if (loadingIndicator != null)
            {
                loadingIndicator.SetActive(isLoading);
            }
        }

        #endregion
    }
}
```

---

### Phase 2: ã‚·ãƒ¼ãƒ³æ§‹ç¯‰ï¼ˆUnity Editorï¼‰

#### Step 2.1: PocketMain ã‚·ãƒ¼ãƒ³ã®ä½œæˆ

1. **File â†’ New Scene** ã§æ–°è¦ã‚·ãƒ¼ãƒ³ä½œæˆ
2. **File â†’ Save As** ã§ `Assets/Scenes/PocketMain.unity` ã¨ã—ã¦ä¿å­˜

#### Step 2.2: Hierarchyæ§‹é€ 

```
PocketMain (Scene)
â”œâ”€â”€ Managers
â”‚   â”œâ”€â”€ AppConfig           â† AppConfig.cs
â”‚   â”œâ”€â”€ DogLocationSync     â† æ—¢å­˜
â”‚   â””â”€â”€ FirebaseManager     â† æ—¢å­˜
â”‚
â”œâ”€â”€ EventSystem
â”‚
â”œâ”€â”€ Canvas (Screen Space - Overlay)
â”‚   â”œâ”€â”€ Header
â”‚   â”‚   â”œâ”€â”€ TitleText       â† "ãŸã£ã·ãƒã‚±ãƒƒãƒˆ"
â”‚   â”‚   â””â”€â”€ SettingsButton  â† å³ä¸Šã€âš™ã‚¢ã‚¤ã‚³ãƒ³
â”‚   â”‚
â”‚   â””â”€â”€ ButtonGrid (Grid Layout Group)
â”‚       â”œâ”€â”€ CallButton      â† ğŸ• ã‚³ãƒ¼ãƒ«
â”‚       â”œâ”€â”€ DressUpButton   â† ğŸ‘• ç€æ›¿ãˆ
â”‚       â”œâ”€â”€ PedometerButton â† ğŸ‘Ÿ æ­©æ•°è¨ˆ
â”‚       â””â”€â”€ MiniGameButton  â† ğŸ® çŠ¬ã¨éŠã¶
â”‚
â”œâ”€â”€ Camera
â”‚   â””â”€â”€ Main Camera
â”‚
â””â”€â”€ PocketMainUI            â† PocketMainUI.cs
```

#### Step 2.3: Canvasè¨­å®š

1. **Canvas** ã‚’é¸æŠ
2. **Canvas Scaler**:
   - UI Scale Mode: `Scale With Screen Size`
   - Reference Resolution: `1080 x 1920`
   - Match: `0.5`

#### Step 2.4: ButtonGridè¨­å®šï¼ˆGrid Layout Groupï¼‰

1. `ButtonGrid` ã« **Grid Layout Group** ã‚’è¿½åŠ 
2. è¨­å®š:
   - Cell Size: `450 x 450`
   - Spacing: `30, 30`
   - Start Corner: `Upper Left`
   - Start Axis: `Horizontal`
   - Child Alignment: `Middle Center`
   - Constraint: `Fixed Column Count`
   - Constraint Count: `2`

#### Step 2.5: ãƒœã‚¿ãƒ³ã‚µã‚¤ã‚º

| ãƒœã‚¿ãƒ³ | ã‚µã‚¤ã‚º | å‚™è€ƒ |
|--------|--------|------|
| 4ã¤ã®ã‚°ãƒªãƒƒãƒ‰ãƒœã‚¿ãƒ³ | 450Ã—450px | Grid Layout Groupã§è‡ªå‹•èª¿æ•´ |
| SettingsButton | 100Ã—100px | å³ä¸Šã«é…ç½® |

#### Step 2.6: ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š

| è¦ç´  | ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º |
|------|--------------|
| ã‚¿ã‚¤ãƒˆãƒ« | 48px |
| ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ | 40px |

---

### Phase 3: å‚ç…§è¨­å®š

#### Step 3.1: PocketMainUI ã®å‚ç…§è¨­å®š

1. `PocketMainUI` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ
2. Inspector ã§å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¨­å®š:

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‚ç…§å…ˆ |
|-----------|--------|
| callButton | CallButton |
| dressUpButton | DressUpButton |
| pedometerButton | PedometerButton |
| miniGameButton | MiniGameButton |
| settingsButton | SettingsButton |
| callButtonText | CallButtonå†…ã®TMP_Text |
| mypageUrl | TapHouseWebã®mypageURL |

---

### Phase 4: ãƒ“ãƒ«ãƒ‰è¨­å®š

#### Step 4.1: ã‚·ãƒ¼ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰ã«è¿½åŠ 

**File â†’ Build Settings**:

```
Scenes In Build:
  0: Scenes/Splash
  1: Scenes/Login
  2: Scenes/ModeSelect      â† ãƒ¢ãƒ¼ãƒ‰é¸æŠï¼ˆã‚ã‚‹å ´åˆï¼‰
  3: Scenes/PocketMain      â† è¿½åŠ 
  4: Scenes/main
  5: Scenes/DressUp         â† å¾Œã§ä½œæˆ
  6: Scenes/Pedometer       â† å¾Œã§ä½œæˆ
  7: Scenes/MiniGames       â† å¾Œã§ä½œæˆ
```

---

## å‹•ä½œç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### åŸºæœ¬å‹•ä½œ

- [ ] ã‚·ãƒ¼ãƒ³ãŒæ­£å¸¸ã«é–‹ã
- [ ] 4ã¤ã®ãƒœã‚¿ãƒ³ãŒ2Ã—2ã‚°ãƒªãƒƒãƒ‰ã§è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒœã‚¿ãƒ³ã‚µã‚¤ã‚ºãŒé©åˆ‡ï¼ˆã‚¿ãƒƒãƒ—ã—ã‚„ã™ã„ï¼‰

### ã‚³ãƒ¼ãƒ«æ©Ÿèƒ½

- [ ] ã‚³ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ— â†’ main.unityã«é·ç§»
- [ ] main.unityã§çŠ¬ã¨éŠã¹ã‚‹

### è‡ªå‹•å¸°é‚„

- [ ] main.unityã‹ã‚‰ãƒã‚±ãƒƒãƒˆãƒ¡ã‚¤ãƒ³ã«æˆ»ã‚‹ â†’ çŠ¬ãŒãƒ¡ã‚¤ãƒ³æ©Ÿã«è‡ªå‹•å¸°é‚„

### è¨­å®šãƒœã‚¿ãƒ³

- [ ] è¨­å®šãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ— â†’ OSãƒ–ãƒ©ã‚¦ã‚¶ã§mypageãŒé–‹ã

### ãã®ä»–ã®ãƒœã‚¿ãƒ³

- [ ] ç€ã›æ›¿ãˆãƒœã‚¿ãƒ³ â†’ DressUp ã‚·ãƒ¼ãƒ³ï¼ˆæœªå®Ÿè£…ãªã‚‰è­¦å‘Šï¼‰
- [ ] æ­©æ•°è¨ˆãƒœã‚¿ãƒ³ â†’ Pedometer ã‚·ãƒ¼ãƒ³ï¼ˆæœªå®Ÿè£…ãªã‚‰è­¦å‘Šï¼‰
- [ ] çŠ¬ã¨éŠã¶ãƒœã‚¿ãƒ³ â†’ MiniGames ã‚·ãƒ¼ãƒ³ï¼ˆæœªå®Ÿè£…ãªã‚‰è­¦å‘Šï¼‰

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **DressUp.unity** ã‚·ãƒ¼ãƒ³ã®ä½œæˆ â†’ [dress-up.md](./features/dress-up.md)
2. **Pedometer.unity** ã‚·ãƒ¼ãƒ³ã®ä½œæˆ â†’ [pedometer.md](./features/pedometer.md)
3. **MiniGames.unity** ã‚·ãƒ¼ãƒ³ã®ä½œæˆ â†’ [brain-training.md](./features/brain-training.md)

---

## ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|----------|------|
| `Assets/Scenes/PocketMain.unity` | ãƒã‚±ãƒƒãƒˆãƒ¡ã‚¤ãƒ³ç”»é¢ã‚·ãƒ¼ãƒ³ |
| `Assets/Scripts/Pocket/AppConfig.cs` | ã‚¢ãƒ—ãƒªãƒ¢ãƒ¼ãƒ‰ç®¡ç† |
| `Assets/Scripts/UI/ModeSelect/PocketMainUI.cs` | ãƒ¡ã‚¤ãƒ³ç”»é¢UIåˆ¶å¾¡ |

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | èª¬æ˜ |
|-------------|------|
| [pocket-overview.md](./pocket-overview.md) | å…¨ä½“æ¦‚è¦ |
| [call-dog.md](./features/call-dog.md) | ã‚³ãƒ¼ãƒ«æ©Ÿèƒ½è©³ç´° |
| [ui-architecture.md](./ui-architecture.md) | UIè¨­è¨ˆè©³ç´° |


ã¾ãšã€ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ãŸã¨ãã«ã€åˆæœŸç”»é¢ã‚’ã“ã®.unityã«ã—ãŸã„ã‚“ã§ã™ã‘ã©ã€ãã‚Œã£ã¦ã©ã†ã‚„ã£ã¦ã‚„ã‚Šã¾ã™ã‹ï¼Ÿ

Firebaseèªè¨¼ç¢ºèª ä¸­ã¯ã€ uiã‚’è¡¨ç¤ºã—ãªã„ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ãŒã€ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹æ–¹å‘ã«å¤‰ãˆãŸã„ã€‚