# たっぷポケット 全体概要

## 1. コンセプト

### 1.1 アプリの位置づけ

「たっぷポケット」は、メインアプリ「たっぷハウス」のサブ端末アプリとして設計された高齢者向けスマホアプリ。

**重要な設計思想:** たっぷポケットとたっぷハウスは**同じ機能を共有**する。違いはエントリーポイント（起動画面）とUIレイアウトのみ。

```
┌─────────────────────────────────────────────────────────────┐
│                    たっぷハウス エコシステム                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────────────┐    ┌─────────────────────┐       │
│   │   たっぷハウス       │    │   たっぷポケット    │       │
│   │   （メインアプリ）   │←→│   （サブアプリ）    │       │
│   │                     │    │                     │       │
│   │   - タブレット向け   │    │   - スマホ向け     │       │
│   │   - 自宅設置        │    │   - 携帯用         │       │
│   │   - メイン画面起動   │    │   - ポケット画面起動│       │
│   └─────────────────────┘    └─────────────────────┘       │
│                     ↑                ↑                     │
│                     └────────────────┘                     │
│                ┌────────────────────────┐                  │
│                │  共通コードベース       │                  │
│                │  同じ機能・同じ犬の状態  │                  │
│                │  Firebase同期          │                  │
│                └────────────────────────┘                  │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 ターゲットユーザー

| 属性 | 詳細 |
|------|------|
| **メインターゲット** | 高齢者（60歳以上） |
| **利用シーン** | 外出時、寝室、別室での利用 |
| **デバイス** | スマートフォン（Android/iOS） |
| **前提条件** | たっぷハウス（メインアプリ）を既に利用中 |

### 1.3 主な用途

1. **外出時に犬と一緒** - 犬をポケットに呼び出して外出、フル機能で世話
2. **健康管理** - 歩数計で自分と犬の歩数を管理
3. **犬と遊ぶ** - ミニゲームで犬と一緒に遊ぶ
4. **着せ替え** - 犬のファッションを楽しむ
5. **メタバース散歩** - 他のユーザーと一緒に散歩

---

## 2. 主要機能

### 2.1 機能一覧

| # | 機能名 | 説明 | 優先度 |
|---|--------|------|--------|
| 1 | コール | メイン機から犬を呼ぶ → **フル機能が使える** | 必須 |
| 2 | 着せ替え | 犬に服・帽子を着せる | 必須 |
| 3 | 歩数計 | 犬とユーザーの歩数表示 | 必須 |
| 4 | 犬と遊ぼう | 犬と一緒に遊ぶミニゲーム | 必須 |
| 5 | 設定 | 各種設定 | 必須 |
| 6 | メタバース散歩 | 内蔵メタバース機能 | 追加 |
| 7 | 通話 | 高齢者向け音声通話 | 追加 |
| 8 | チャット | テキストチャット | 後回し |

### 2.2 コール後のフル機能

**重要:** 犬を呼んだ後は、たっぷハウスと同じフル機能が使える。

```
┌─────────────────────────────────────────────────────────────┐
│                    コール後のフル機能                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ポケットで「コール」ボタンを押すと...                      │
│                                                             │
│   ┌─────────────────────────────────────────────────┐      │
│   │   たっぷハウス画面に遷移（フル機能）              │      │
│   │                                                   │      │
│   │   - 餌やり ✓                                      │      │
│   │   - おもちゃ遊び ✓                                │      │
│   │   - おやつ ✓                                      │      │
│   │   - なでる ✓                                      │      │
│   │   - 音声コマンド ✓                                │      │
│   │   - すべての既存機能 ✓                            │      │
│   └─────────────────────────────────────────────────┘      │
│                                                             │
│   ※ コードは共通、UIとエントリーポイントだけが異なる        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 機能概要図

```
┌─────────────────────────────────────────────────────────────┐
│                    たっぷポケット 機能構成                   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌───────────────────────────────────────────────────────┐ │
│  │                  ポケットメイン画面                    │ │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐    │ │
│  │  │ コール   │ │ 着せ替え │ │ 歩数計  │ │犬と遊ぼう│    │ │
│  │  │   🐕    │ │   👕    │ │   👟    │ │   🎮    │    │ │
│  │  └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘    │ │
│  └───────┼──────────┼──────────┼──────────┼───────────┘ │
│          │          │          │          │              │
│          ↓          ↓          ↓          ↓              │
│  ┌───────────────────────────────────────────────────────┐ │
│  │              共通コードベース                          │ │
│  │  ┌────────────────┐ ┌────────────────┐               │ │
│  │  │ たっぷハウス機能 │ │   Firebase同期  │               │ │
│  │  │ 餌/遊び/おやつ等│ │   犬の状態共有  │               │ │
│  │  └────────────────┘ └────────────────┘               │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐ │
│  │              メタバース機能（追加）                     │ │
│  │  ┌────────┐ ┌────────┐ ┌────────┐                    │ │
│  │  │ 散歩   │ │ 通話   │ │チャット│                    │ │
│  │  │       │ │       │ │（後回し）│                   │ │
│  │  └────────┘ └────────┘ └────────┘                    │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 技術アーキテクチャ

### 3.1 ビルド構成

同一Unityプロジェクト、同一コードベースから**AppMode**でエントリーポイントを切り替える。

**重要:** Define Symbolsによる完全分離は行わない。機能は共通。

```csharp
public enum AppMode
{
    TapHouse,   // たっぷハウス（メイン画面から開始）
    TapPocket   // たっぷポケット（ポケット画面から開始）
}
```

| アプリ | AppMode | 起動画面 | 機能 |
|--------|---------|----------|------|
| たっぷハウス | `TapHouse` | main.unity | フル機能 |
| たっぷポケット | `TapPocket` | PocketMain.unity | フル機能（コール後） |

詳細: [build-configuration.md](./build-configuration.md)

### 3.2 プラットフォーム対応

| プラットフォーム | 対応 | 備考 |
|-----------------|------|------|
| Android | ○ | Google Play配布 |
| iOS | ○ | App Store配布 |

### 3.3 主要技術スタック

| 技術 | 用途 |
|------|------|
| Unity 6 | ゲームエンジン |
| Firebase Realtime Database | デバイス間同期 |
| Firebase Authentication | ユーザー認証 |
| Google Fit API (Android) | 歩数計 |
| HealthKit (iOS) | 歩数計 |
| Photon Fusion 2 | メタバース同期 |
| Photon Voice 2 | 音声通話 |

---

## 4. 画面遷移

### 4.1 画面遷移図

```
┌─────────────────────────────────────────────────────────────┐
│                       画面遷移図                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                    ┌───────────┐                            │
│                    │ スプラッシュ │                          │
│                    └─────┬─────┘                            │
│                          ↓                                  │
│                    ┌───────────┐                            │
│            ┌──────→│ポケットメイン│←──────┐                │
│            │       │（犬なし）  │       │                   │
│            │       └─────┬─────┘       │                   │
│            │             │             │                   │
│    ┌───────┴───────┬─────┴─────┬───────┴───────┐          │
│    ↓               ↓           ↓               ↓          │
│ ┌──────┐     ┌──────┐    ┌──────┐      ┌──────┐          │
│ │着せ替え│     │ 歩数計 │    │犬と遊ぼう│      │ 設定  │   │
│ └──────┘     └──────┘    └──────┘      └──────┘          │
│                                                             │
│ ┌───────────────────────────────────────────────────────┐  │
│ │  コールボタン押下                                       │  │
│ │            ↓                                           │  │
│ │  ┌─────────────────┐                                   │  │
│ │  │  たっぷハウス画面  │  ← 共通のフル機能画面           │  │
│ │  │  （犬あり）       │    餌やり、遊び、おやつ等        │  │
│ │  └─────────────────┘                                   │  │
│ └───────────────────────────────────────────────────────┘  │
│                                                             │
│                    ┌───────────┐                            │
│                    │メタバース  │  ← ポケットメインから遷移  │
│                    │   散歩    │                            │
│                    └───────────┘                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 画面一覧

| # | 画面名 | 説明 | 犬の表示 |
|---|--------|------|----------|
| 1 | スプラッシュ | 起動画面 | なし |
| 2 | ポケットメイン | ホーム画面（メニューのみ） | **なし** |
| 3 | たっぷハウス画面 | コール後のフル機能画面 | **あり** |
| 4 | 着せ替え | 犬の着せ替え画面 | あり |
| 5 | 歩数計 | 歩数表示画面 | なし |
| 6 | 犬と遊ぼう | ミニゲーム選択・プレイ画面 | あり |
| 7 | 設定 | 各種設定画面 | なし |
| 8 | メタバース散歩 | 散歩シーン | あり |

**注意:** ポケットメイン画面には犬を表示しない。犬は「コール」で呼んだ後に表示される。

---

## 5. Firebase連携

### 5.1 共有データ

たっぷハウスとたっぷポケットは同じFirebaseプロジェクトを使用し、以下のデータを共有する。

| データ | パス | 説明 |
|--------|------|------|
| 犬の位置 | `users/{userId}/dogLocation` | どのデバイスに犬がいるか |
| 犬の状態 | `users/{userId}/dogState` | 愛情度、空腹度、要求度など |
| 着せ替え | `users/{userId}/dressUp` | 現在の服・帽子 |
| 歩数 | `users/{userId}/steps` | 日別歩数データ |
| ゲームスコア | `users/{userId}/miniGames` | ミニゲームスコア |

### 5.2 データフロー

```
┌─────────────────┐          ┌─────────────────┐
│  たっぷハウス    │          │  たっぷポケット  │
│  （メイン機）    │          │  （サブ機）      │
└────────┬────────┘          └────────┬────────┘
         │                            │
         │   同じコードベース          │
         │   同じ機能                  │
         │                            │
         │    ┌──────────────┐        │
         └───→│   Firebase   │←───────┘
              │  Realtime DB │
              │              │
              │  犬の状態共有 │
              └──────────────┘
```

---

## 6. 差別化ポイント

### 6.1 vs たっぷハウス

| 項目 | たっぷハウス | たっぷポケット |
|------|-------------|---------------|
| 画面サイズ | タブレット向け | スマホ向け |
| 起動画面 | メイン画面（犬あり） | ポケット画面（犬なし） |
| 利用シーン | 自宅固定 | 外出・携帯 |
| 餌やり | ○ | ○（コール後） |
| 遊び | ○ | ○（コール後） |
| リマインダー | ○ | ○（コール後） |
| 着せ替え | ○ | ○ |
| 歩数計 | △ | ○ |
| 犬と遊ぼう | △ | ○ |
| 加速度歩行 | × | ○ |

**注:** コール後は同じ機能が使えるため、機能差はほぼない。UIとエントリーポイントの違いのみ。

### 6.2 高齢者向け配慮

| 配慮 | 実装 |
|------|------|
| **大きなボタン** | 100dp以上のタップ領域 |
| 高コントラスト | 背景色と文字色の明確な差 |
| シンプルなUI | 1画面に機能を詰め込まない |
| 大きな文字 | 18sp以上のフォントサイズ |
| 音量ブースト | 通話機能での音量増幅 |
| 設定アクセス | ヘッダー右上に配置（常に見える） |

---

## 7. 開発フェーズ

### 7.1 フェーズ分け

| フェーズ | 内容 | 機能 |
|---------|------|------|
| **Phase 1** | MVP | コール、着せ替え、基本UI |
| **Phase 2** | 健康・遊び | 歩数計、犬と遊ぼう |
| **Phase 3** | メタバース | 散歩、通話 |
| **Phase 4** | 拡張 | チャット、追加ゲーム |

### 7.2 依存関係

```
Phase 1: コール・着せ替え
    ↓
Phase 2: 歩数計・犬と遊ぼう（Phase 1必須）
    ↓
Phase 3: メタバース・通話（Phase 2推奨）
    ↓
Phase 4: チャット・拡張（Phase 3必須）
```

---

## 8. 関連ドキュメント

| ドキュメント | 説明 |
|-------------|------|
| [build-configuration.md](./build-configuration.md) | ビルド分け詳細（AppMode方式） |
| [features/](./features/) | 各機能の詳細仕様 |
| [metaverse/](./metaverse/) | メタバース機能の詳細 |
